<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Pronunciation Practice</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        min-height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
        padding: 20px;
      }

      .container {
        background: white;
        border-radius: 20px;
        padding: 30px;
        box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        text-align: center;
        max-width: 400px;
        width: 100%;
      }

      h1 {
        color: #333;
        margin-bottom: 30px;
        font-size: 1.8rem;
      }

      .word-display {
        font-size: 2.5rem;
        font-weight: bold;
        color: #667eea;
        margin: 20px 0;
        min-height: 60px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .session-info {
        font-size: 1rem;
        color: #666;
        margin: 15px 0;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 8px;
        border-left: 4px solid #667eea;
      }

      .start-btn {
        background: linear-gradient(135deg, #667eea, #764ba2);
        border: none;
        border-radius: 50%;
        width: 120px;
        height: 120px;
        color: white;
        font-size: 1.2rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        margin: 20px 0;
        box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
      }

      .start-btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 15px 30px rgba(102, 126, 234, 0.4);
      }

      .start-btn:active {
        transform: translateY(0);
      }

      .start-btn:disabled {
        opacity: 0.6;
        cursor: not-allowed;
        transform: none;
      }

      .status {
        font-size: 1.1rem;
        margin: 20px 0;
        min-height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
      }

      .listening {
        color: #e74c3c;
        animation: pulse 1.5s infinite;
      }

      .speaking {
        color: #27ae60;
      }

      .playing {
        color: #f39c12;
      }

      .waiting {
        color: #3498db;
      }

      @keyframes pulse {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
        100% {
          opacity: 1;
        }
      }

      .progress {
        background: #ecf0f1;
        border-radius: 10px;
        height: 8px;
        margin: 20px 0;
        overflow: hidden;
      }

      .progress-bar {
        background: linear-gradient(90deg, #667eea, #764ba2);
        height: 100%;
        width: 0%;
        transition: width 0.3s ease;
      }

      .controls {
        display: grid;
        grid-template-columns: repeat(2, 1fr);
        gap: 10px;
        margin-top: 20px;
      }

      .reset-btn {
        background: linear-gradient(135deg, #95a5a6, #7f8c8d);
        border: none;
        border-radius: 8px;
        padding: 10px 15px;
        color: white;
        font-size: 0.9rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.3s ease;
        margin-top: 15px;
        box-shadow: 0 4px 8px rgba(149, 165, 166, 0.3);
      }

      .reset-btn:hover {
        background: linear-gradient(135deg, #7f8c8d, #95a5a6);
        transform: translateY(-1px);
        box-shadow: 0 6px 12px rgba(149, 165, 166, 0.4);
      }

      .reset-btn:active {
        transform: translateY(0);
      }

      .control-group {
        text-align: left;
      }

      .control-group label {
        display: block;
        font-size: 0.9rem;
        color: #666;
        margin-bottom: 5px;
      }

      .control-group input {
        width: 100%;
        padding: 8px;
        border: 2px solid #ecf0f1;
        border-radius: 8px;
        font-size: 0.9rem;
      }

      .control-group input:focus {
        outline: none;
        border-color: #667eea;
      }

      @media (max-width: 480px) {
        .container {
          padding: 20px;
        }

        h1 {
          font-size: 1.5rem;
        }

        .word-display {
          font-size: 2rem;
        }

        .start-btn {
          width: 100px;
          height: 100px;
          font-size: 1rem;
        }

        .controls {
          grid-template-columns: 1fr;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>ðŸŽ¤ Pronunciation Practice</h1>

      <div class="word-display" id="wordDisplay">Ready to start!</div>

      <div class="session-info" id="sessionInfo">Session 1: Words 1-10</div>

      <button class="start-btn" id="startBtn">START</button>

      <div class="status" id="status">Click START to begin</div>

      <div class="progress">
        <div class="progress-bar" id="progressBar"></div>
      </div>

      <div class="controls">
        <div class="control-group">
          <label for="pauseDelay">Pause Delay (ms)</label>
          <input
            type="number"
            id="pauseDelay"
            value="2000"
            min="500"
            max="5000"
          />
        </div>
        <div class="control-group">
          <label for="recordTime">Record Time (ms)</label>
          <input
            type="number"
            id="recordTime"
            value="3000"
            min="1000"
            max="8000"
          />
        </div>
        <div class="control-group">
          <label for="playbackDelay">Playback Delay (ms)</label>
          <input
            type="number"
            id="playbackDelay"
            value="1500"
            min="500"
            max="3000"
          />
        </div>
        <div class="control-group">
          <label for="speechRate">Speech Rate</label>
          <input
            type="range"
            id="speechRate"
            min="0.5"
            max="2"
            step="0.1"
            value="0.9"
          />
        </div>
      </div>

      <button class="reset-btn" id="resetBtn">ðŸ”„ Reset Progress</button>
    </div>

    <script>
      class PronunciationPractice {
        constructor() {
          // Array of 50 English words
          this.words = [
            "pronunciation",
            "beautiful",
            "chocolate",
            "comfortable",
            "vegetables",
            "temperature",
            "international",
            "definitely",
            "beginning",
            "appreciate",
            "achievement",
            "adventure",
            "algorithm",
            "alliance",
            "alternative",
            "ambulance",
            "analysis",
            "anniversary",
            "announcement",
            "anonymous",
            "apartment",
            "appearance",
            "application",
            "appointment",
            "appreciation",
            "appropriate",
            "architecture",
            "arrangement",
            "assessment",
            "assignment",
            "assistance",
            "atmosphere",
            "attention",
            "attraction",
            "authority",
            "availability",
            "background",
            "bankruptcy",
            "basketball",
            "battlefield",
            "bibliography",
            "biological",
            "birthplace",
            "blackboard",
            "blueprint",
            "bookkeeper",
            "breakthrough",
            "broadcast",
            "brotherhood",
            "butterfly",
            "calculator",
            "candidate",
            "capability",
            "capitalism",
            "celebration",
            "certificate",
            "championship",
            "characteristic",
            "chemistry",
            "childhood",
            "chocolate",
            "Christmas",
            "cigarette",
            "civilization",
            "classroom",
            "coalition",
            "collection",
            "combination",
            "comfortable",
            "commander",
            "commercial",
            "commission",
            "commitment",
            "committee",
            "communication",
            "community",
            "comparison",
            "competition",
            "complaint",
            "complement",
            "complexity",
            "component",
            "composition",
            "comprehension",
            "compromise",
            "computer",
            "concentration",
            "conclusion",
            "condition",
            "conference",
            "confidence",
            "conflict",
            "confusion",
            "connection",
            "conscience",
            "consequence",
            "consideration",
            "consistency",
            "constitution",
            "construction",
            "consultation",
            "consumption",
            "container",
            "contemporary",
            "content",
            "contest",
            "contribution",
            "controller",
            "controversy",
            "convention",
            "conversation",
            "cooperation",
            "corporation",
            "correction",
            "corruption",
            "counselor",
            "countryside",
            "creativity",
            "criticism",
            "curiosity",
            "curriculum",
            "customer",
            "daughter",
            "decision",
            "declaration",
            "decoration",
            "definition",
            "democracy",
            "demonstration",
            "department",
            "dependency",
            "description",
            "destination",
            "destruction",
            "development",
            "dictionary",
            "difference",
            "difficulty",
            "dimension",
            "direction",
            "directory",
            "disability",
            "disappointment",
            "discipline",
            "discrimination",
            "discussion",
            "distribution",
            "diversity",
            "document",
            "domestic",
            "donation",
            "dramatic",
            "drinking",
            "economic",
            "education",
            "effective",
            "efficiency",
            "election",
            "electronic",
            "elementary",
            "elimination",
            "emergency",
            "emotion",
            "emphasis",
            "employment",
            "encyclopedia",
            "engineering",
            "enhancement",
            "enjoyment",
            "enormous",
            "entertainment",
            "enthusiasm",
            "environment",
            "equipment",
            "establishment",
            "evaluation",
            "evening",
            "everybody",
            "everything",
            "evidence",
            "examination",
            "example",
            "exception",
            "excitement",
            "exercise",
            "exhibition",
            "existence",
            "expansion",
            "expectation",
            "experience",
            "experiment",
            "explanation",
            "exploration",
            "expression",
            "extension",
            "extreme",
            "facility",
            "factory",
            "familiar",
            "fantastic",
            "fashion",
            "favorite",
            "feature",
            "federal",
            "feedback",
            "fiction",
            "financial",
            "finding",
            "fishing",
            "fitness",
            "flexibility",
            "football",
            "foreign",
            "forest",
            "formation",
            "formula",
            "foundation",
            "framework",
            "freedom",
            "frequency",
            "friendship",
            "function",
            "fundamental",
            "furniture",
            "gallery",
            "gambling",
            "garden",
            "gathering",
            "general",
            "generation",
            "geography",
            "girlfriend",
            "government",
            "graduation",
            "grammar",
            "grandfather",
            "grandmother",
            "graphic",
            "grocery",
            "growth",
            "guarantee",
            "guidance",
            "guideline",
            "habitat",
            "handful",
            "happiness",
            "hardware",
            "headline",
            "headquarters",
            "health",
            "hearing",
            "heritage",
            "highlight",
            "highway",
            "historian",
            "historical",
            "holiday",
            "homework",
            "hospital",
            "housing",
            "humanity",
            "hurricane",
            "husband",
            "identity",
            "imagination",
            "immigration",
            "implementation",
            "importance",
            "impression",
            "improvement",
            "incentive",
            "incident",
            "inclusion",
            "income",
            "increase",
            "independence",
            "indication",
            "individual",
            "industry",
            "infection",
            "inflation",
            "influence",
            "information",
            "ingredient",
            "initiative",
            "injection",
            "innovation",
            "inspection",
            "installation",
            "instance",
            "institution",
            "instruction",
            "instrument",
            "insurance",
            "intelligence",
            "intention",
            "interaction",
            "interest",
            "interference",
            "internal",
            "international",
            "internet",
            "interpretation",
            "interview",
            "introduction",
            "invasion",
            "investigation",
            "investment",
            "invitation",
            "involvement",
            "island",
            "jacket",
            "journey",
            "judgment",
            "justice",
            "keyboard",
            "kitchen",
            "knowledge",
            "laboratory",
            "landscape",
            "language",
            "laughter",
            "laundry",
            "leadership",
            "learning",
            "leather",
            "lecture",
            "legislation",
            "leisure",
            "length",
            "library",
            "license",
            "lifestyle",
            "lighting",
            "limitation",
            "literature",
            "location",
            "magazine",
            "maintenance",
            "majority",
            "management",
            "manufacturer",
            "marketing",
            "marriage",
            "material",
            "mathematics",
            "maximum",
            "meaning",
            "measurement",
            "mechanism",
            "medicine",
            "meeting",
            "membership",
            "memory",
            "mention",
            "message",
            "method",
            "middle",
            "military",
            "minimum",
            "minority",
            "mission",
            "mistake",
            "mixture",
            "mobile",
            "model",
            "modification",
            "moment",
            "monitor",
            "morning",
            "mortgage",
            "mother",
            "motivation",
            "mountain",
            "movement",
            "muscle",
            "museum",
            "music",
            "mystery",
            "national",
            "natural",
            "nature",
            "navigation",
            "necessary",
            "negative",
            "negotiation",
            "neighborhood",
            "network",
            "newspaper",
            "nomination",
            "normal",
            "northern",
            "nothing",
            "notice",
            "notification",
            "number",
            "objective",
            "obligation",
            "observation",
            "occasion",
            "occupation",
            "ocean",
            "office",
            "operation",
            "opinion",
            "opportunity",
            "opposite",
            "option",
            "orange",
            "order",
            "organization",
            "orientation",
            "original",
            "outcome",
            "outline",
            "output",
            "outside",
            "overall",
            "ownership",
            "package",
            "painting",
            "paper",
            "paragraph",
            "parameter",
            "parent",
            "parking",
            "parliament",
            "participation",
            "particular",
            "partnership",
            "passenger",
            "passion",
            "password",
            "patience",
            "patient",
            "pattern",
            "payment",
            "penalty",
            "people",
            "perception",
            "performance",
            "period",
            "permission",
            "person",
            "personality",
            "perspective",
            "philosophy",
            "photograph",
            "physical",
            "picture",
            "piece",
            "place",
            "planning",
            "platform",
            "player",
            "pleasure",
            "pocket",
            "poetry",
            "point",
            "policy",
            "political",
            "pollution",
            "popular",
            "population",
            "position",
            "positive",
            "possibility",
            "potential",
            "poverty",
            "power",
            "practice",
            "prayer",
            "preference",
            "pregnancy",
            "preparation",
            "presence",
            "presentation",
            "preservation",
            "president",
            "pressure",
            "prevention",
            "price",
            "pride",
            "primary",
            "principle",
            "priority",
            "privacy",
            "private",
            "probability",
            "problem",
            "procedure",
            "process",
            "production",
            "profession",
            "profile",
            "profit",
            "program",
            "project",
            "promise",
            "promotion",
            "property",
            "proposal",
            "protection",
            "psychology",
            "public",
            "publication",
            "purpose",
            "quality",
            "quantity",
            "quarter",
            "question",
            "quick",
            "radio",
            "railway",
            "range",
            "ratio",
            "reaction",
            "reading",
            "reality",
            "reason",
            "receipt",
            "reception",
            "recognition",
            "recommendation",
            "record",
            "recovery",
            "reduction",
            "reference",
            "reflection",
            "reform",
            "region",
            "registration",
            "regulation",
            "rejection",
            "relation",
            "relationship",
            "release",
            "religion",
            "reminder",
            "removal",
            "repair",
            "repeat",
            "replacement",
            "report",
            "representation",
            "reputation",
            "request",
            "requirement",
            "research",
            "reservation",
            "residence",
            "resolution",
            "resource",
            "respect",
            "response",
            "responsibility",
            "restaurant",
            "result",
            "retirement",
            "return",
            "revenue",
            "review",
            "revolution",
            "reward",
            "rhythm",
            "right",
            "river",
            "safety",
            "salary",
            "sample",
            "satisfaction",
            "scale",
            "schedule",
            "scheme",
            "scholarship",
            "school",
            "science",
            "screen",
            "script",
            "search",
            "season",
            "second",
            "secret",
            "section",
            "security",
            "selection",
            "sense",
            "sentence",
            "series",
            "service",
            "session",
            "setting",
            "settlement",
            "setup",
            "sharing",
            "shelter",
            "shipping",
            "shopping",
            "shoulder",
            "sight",
            "signal",
            "signature",
            "significance",
            "silence",
            "silver",
            "simple",
            "sister",
            "situation",
            "skill",
            "smoke",
            "social",
            "society",
            "software",
            "solution",
            "something",
            "sound",
            "source",
            "southern",
            "space",
            "specialist",
            "specific",
            "speech",
            "spirit",
            "sport",
            "square",
            "stage",
            "standard",
            "statement",
            "station",
            "statistics",
            "status",
            "storage",
            "story",
            "strategy",
            "strength",
            "stress",
            "structure",
            "struggle",
            "student",
            "study",
            "style",
            "subject",
            "submission",
            "substance",
            "success",
            "suggestion",
            "summer",
            "support",
            "surface",
            "surgery",
            "surprise",
            "survey",
            "survival",
            "suspect",
            "symbol",
            "sympathy",
            "system",
            "table",
            "target",
            "task",
            "teacher",
            "teaching",
            "team",
            "technology",
            "telephone",
            "television",
            "temperature",
            "tennis",
            "tension",
            "territory",
            "terror",
            "testing",
            "theater",
            "theory",
            "therapy",
            "thought",
            "thread",
            "threat",
            "ticket",
            "timeline",
            "title",
            "today",
            "tomorrow",
            "tonight",
            "topic",
            "total",
            "touch",
            "tourist",
            "tournament",
            "track",
            "trade",
            "tradition",
            "traffic",
            "training",
            "transfer",
            "transformation",
            "transition",
            "translation",
            "transportation",
            "travel",
            "treatment",
            "trouble",
            "truck",
            "trust",
            "truth",
            "tunnel",
            "turkey",
            "turning",
            "tutorial",
            "uncle",
            "understanding",
            "union",
            "unique",
            "unit",
            "university",
            "update",
            "upgrade",
            "usage",
            "user",
            "utility",
            "vacation",
            "valley",
            "value",
            "variation",
            "variety",
            "vehicle",
            "venture",
            "version",
            "victim",
            "video",
            "village",
            "virus",
            "vision",
            "visit",
            "visual",
            "voice",
            "volume",
            "waiting",
            "walking",
            "warning",
            "waste",
            "water",
            "weather",
            "website",
            "wedding",
            "weight",
            "welcome",
            "welfare",
            "western",
            "window",
            "winter",
            "wisdom",
            "witness",
            "woman",
            "wonder",
            "working",
            "workshop",
            "world",
            "worry",
            "writing",
            "yellow",
            "yesterday",
            "young",
            "youth",
          ];

          this.wordsPerSession = 10;
          this.currentWordIndex = 0;
          this.sessionStartIndex = 0;
          this.currentSessionWords = [];
          this.isRunning = false;
          this.mediaRecorder = null;
          this.audioChunks = [];
          this.recordedAudio = null;

          this.initializeElements();
          this.setupEventListeners();
          this.checkBrowserSupport();
          this.loadProgress();
          this.updateSessionInfo();
        }

        initializeElements() {
          this.wordDisplay = document.getElementById("wordDisplay");
          this.sessionInfo = document.getElementById("sessionInfo");
          this.startBtn = document.getElementById("startBtn");
          this.resetBtn = document.getElementById("resetBtn");
          this.status = document.getElementById("status");
          this.progressBar = document.getElementById("progressBar");
          this.pauseDelayInput = document.getElementById("pauseDelay");
          this.recordTimeInput = document.getElementById("recordTime");
          this.playbackDelayInput = document.getElementById("playbackDelay");
          this.speechRateInput = document.getElementById("speechRate");
        }

        setupEventListeners() {
          this.startBtn.addEventListener("click", () => {
            if (this.isRunning) {
              this.stopPractice();
            } else {
              this.startPractice();
            }
          });

          this.resetBtn.addEventListener("click", () => {
            this.resetProgress();
          });
        }

        checkBrowserSupport() {
          if (!("speechSynthesis" in window)) {
            this.updateStatus(
              "Speech synthesis not supported in this browser",
              "error",
            );
            this.startBtn.disabled = true;
            return;
          }

          if (!navigator.mediaDevices || !navigator.mediaDevices.getUserMedia) {
            this.updateStatus(
              "Microphone access not supported in this browser",
              "error",
            );
            this.startBtn.disabled = true;
            return;
          }
        }

        loadProgress() {
          try {
            const savedIndex = parseInt(
              localStorage.getItem("pronunciationSessionIndex") || "0",
            );
            this.sessionStartIndex = savedIndex;
          } catch (error) {
            console.log("LocalStorage not available, using memory storage");
            this.sessionStartIndex = 0;
          }
        }

        saveProgress() {
          try {
            localStorage.setItem(
              "pronunciationSessionIndex",
              this.sessionStartIndex.toString(),
            );
          } catch (error) {
            console.log("LocalStorage not available, progress not saved");
          }
        }

        updateSessionInfo() {
          const sessionNumber =
            Math.floor(this.sessionStartIndex / this.wordsPerSession) + 1;
          const startWord = this.sessionStartIndex + 1;
          const endWord = Math.min(
            this.sessionStartIndex + this.wordsPerSession,
            this.words.length,
          );
          this.sessionInfo.textContent = `Session ${sessionNumber}: Words ${startWord}-${endWord}`;

          if (this.sessionStartIndex >= this.words.length) {
            this.sessionInfo.textContent =
              "All words completed! Resetting to start.";
            this.sessionStartIndex = 0;
            this.saveProgress();
            this.updateSessionInfo();
          }
        }

        getCurrentSessionWords() {
          const startIndex = this.sessionStartIndex;
          const endIndex = Math.min(
            startIndex + this.wordsPerSession,
            this.words.length,
          );
          return this.words.slice(startIndex, endIndex);
        }

        async startPractice() {
          if (this.isRunning) return;

          this.currentSessionWords = this.getCurrentSessionWords();

          if (this.currentSessionWords.length === 0) {
            this.updateStatus("All words completed!", "success");
            return;
          }

          this.isRunning = true;
          this.currentWordIndex = 0;
          this.startBtn.textContent = "STOP";
          this.startBtn.style.background =
            "linear-gradient(135deg, #e74c3c, #c0392b)";
          this.updateProgress(0);

          try {
            await this.requestMicrophonePermission();
            await this.practiceLoop();
          } catch (error) {
            console.error("Practice error:", error);
            this.updateStatus("Error: " + error.message, "error");
          } finally {
            this.resetPractice();
          }
        }

        async requestMicrophonePermission() {
          try {
            const stream = await navigator.mediaDevices.getUserMedia({
              audio: true,
            });
            stream.getTracks().forEach((track) => track.stop());
          } catch (error) {
            throw new Error("Microphone permission denied or not available");
          }
        }

        async practiceLoop() {
          while (
            this.currentWordIndex < this.currentSessionWords.length &&
            this.isRunning
          ) {
            const currentWord = this.currentSessionWords[this.currentWordIndex];
            this.wordDisplay.textContent = currentWord;
            this.updateProgress(
              (this.currentWordIndex / this.currentSessionWords.length) * 100,
            );

            // Step 3: Play the word
            await this.speakWord(currentWord);

            if (!this.isRunning) break;

            // Step 4: Pause
            await this.delay(
              parseInt(this.pauseDelayInput.value),
              "Preparing to record...",
            );

            if (!this.isRunning) break;

            // Step 5: Record user pronunciation
            await this.recordUserAudio();

            if (!this.isRunning) break;

            // Step 6: Play recorded audio
            await this.playRecordedAudio();

            if (!this.isRunning) break;

            // Step 7: Delay before next word (skip for last word)
            if (this.currentWordIndex < this.currentSessionWords.length - 1) {
              await this.delay(
                parseInt(this.playbackDelayInput.value),
                "Next word coming up...",
              );
            }

            this.currentWordIndex++;
          }

          if (this.isRunning) {
            this.updateStatus("Session completed! Great job! ðŸŽ‰", "success");
            this.wordDisplay.textContent = "Session Complete!";
            this.updateProgress(100);

            this.sessionStartIndex += this.wordsPerSession;
            this.saveProgress();
            this.updateSessionInfo();
          }
        }

        speakWord(word) {
          return new Promise((resolve) => {
            this.updateStatus(`ðŸ”Š Listen: "${word}"`, "speaking");

            const utterance = new SpeechSynthesisUtterance(word);
            utterance.lang = "en-US";
            utterance.rate = parseFloat(this.speechRateInput.value);
            utterance.pitch = 1;
            utterance.volume = 1;

            utterance.onend = () => resolve();
            utterance.onerror = () => resolve();

            speechSynthesis.speak(utterance);
          });
        }

        playDingSound() {
          return new Promise((resolve) => {
            const audioContext = new (window.AudioContext ||
              window.webkitAudioContext)();
            const oscillator = audioContext.createOscillator();
            const gainNode = audioContext.createGain();

            oscillator.connect(gainNode);
            gainNode.connect(audioContext.destination);

            oscillator.frequency.setValueAtTime(800, audioContext.currentTime);
            oscillator.type = "sine";

            gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
            gainNode.gain.exponentialRampToValueAtTime(
              0.01,
              audioContext.currentTime + 0.3,
            );

            oscillator.start(audioContext.currentTime);
            oscillator.stop(audioContext.currentTime + 0.3);

            oscillator.onended = () => {
              audioContext.close();
              resolve();
            };
          });
        }

        async recordUserAudio() {
          return new Promise(async (resolve, reject) => {
            try {
              const stream = await navigator.mediaDevices.getUserMedia({
                audio: {
                  echoCancellation: true,
                  noiseSuppression: true,
                  sampleRate: 44100,
                },
              });

              this.audioChunks = [];
              this.mediaRecorder = new MediaRecorder(stream, {
                mimeType: MediaRecorder.isTypeSupported("audio/webm")
                  ? "audio/webm"
                  : "audio/mp4",
              });

              this.mediaRecorder.ondataavailable = (event) => {
                if (event.data.size > 0) {
                  this.audioChunks.push(event.data);
                }
              };

              this.mediaRecorder.onstop = () => {
                const audioBlob = new Blob(this.audioChunks, {
                  type: "audio/wav",
                });
                this.recordedAudio = new Audio(URL.createObjectURL(audioBlob));
                stream.getTracks().forEach((track) => track.stop());
                resolve();
              };

              await this.playDingSound();

              if (!this.isRunning) {
                stream.getTracks().forEach((track) => track.stop());
                resolve();
                return;
              }

              this.updateStatus("ðŸŽ¤ Recording... Speak now!", "listening");
              this.mediaRecorder.start();

              setTimeout(() => {
                if (
                  this.mediaRecorder &&
                  this.mediaRecorder.state === "recording"
                ) {
                  this.mediaRecorder.stop();
                }
              }, parseInt(this.recordTimeInput.value));
            } catch (error) {
              reject(
                new Error("Failed to access microphone: " + error.message),
              );
            }
          });
        }

        async playRecordedAudio() {
          return new Promise((resolve) => {
            if (!this.recordedAudio) {
              resolve();
              return;
            }

            this.updateStatus("ðŸ”Š Playing your recording...", "playing");

            this.recordedAudio.onended = () => resolve();
            this.recordedAudio.onerror = () => resolve();

            this.recordedAudio.play().catch(() => resolve());
          });
        }

        delay(ms, message = "Waiting...") {
          return new Promise((resolve) => {
            this.updateStatus(message, "waiting");
            setTimeout(resolve, ms);
          });
        }

        updateStatus(message, type = "") {
          this.status.textContent = message;
          this.status.className = `status ${type}`;
        }

        updateProgress(percentage) {
          this.progressBar.style.width = percentage + "%";
        }

        stopPractice() {
          this.isRunning = false;
          this.startBtn.textContent = "START";
          this.startBtn.style.background =
            "linear-gradient(135deg, #667eea, #764ba2)";
          this.updateStatus("Practice stopped", "waiting");

          if (speechSynthesis.speaking) {
            speechSynthesis.cancel();
          }

          if (this.mediaRecorder && this.mediaRecorder.state === "recording") {
            this.mediaRecorder.stop();
          }

          if (this.recordedAudio && !this.recordedAudio.paused) {
            this.recordedAudio.pause();
            this.recordedAudio.currentTime = 0;
          }
        }

        resetPractice() {
          this.isRunning = false;
          this.startBtn.textContent = "START";
          this.startBtn.style.background =
            "linear-gradient(135deg, #667eea, #764ba2)";
          this.currentWordIndex = 0;

          if (this.mediaRecorder && this.mediaRecorder.state === "recording") {
            this.mediaRecorder.stop();
          }

          if (this.recordedAudio && this.recordedAudio.src) {
            URL.revokeObjectURL(this.recordedAudio.src);
          }
        }

        resetProgress() {
          // Stop any running practice
          if (this.isRunning) {
            this.stopPractice();
          }

          // Reset session progress to beginning
          this.sessionStartIndex = 0;
          this.currentWordIndex = 0;
          this.saveProgress();
          this.updateSessionInfo();
          this.updateProgress(0);

          // Reset display
          this.wordDisplay.textContent = "Ready to start!";
          this.updateStatus(
            "Progress reset! Click START to begin from Session 1",
            "waiting",
          );
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        new PronunciationPractice();
      });
    </script>
  </body>
</html>
